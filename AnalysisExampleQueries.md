# Example Queries

Funnels for mission progression will also be created

```sql
SELECT GTTREATMENTGROUP, COUNT(DISTINCT USERID)
FROM EVENTS
WHERE EVENTNAME = 'gameTuneAnswerUsed'
AND GTANSWERNAME = 'difficulty_ramp'
GROUP BY GTTREATMENTGROUP
```

```sql
SELECT GTANSWERVALUE, COUNT(DISTINCT USERID)
FROM EVENTS
WHERE EVENTNAME = 'gameTuneAnswerUsed'
AND GTANSWERNAME = 'difficulty_ramp'
GROUP BY GTANSWERVALUE
```

Pivot this table for visualisation:

```sql
SELECT EVENT_DATE,
        GTANSWERVALUE,
        COUNT(DISTINCT USER_ID) AS DAU
FROM FACT_USER_SESSIONS_DAY
WHERE EVENTNAME = 'gameTuneAnswerUsed'
AND GTANSWERNAME = 'difficulty_ramp'
GROUP BY EVENT_DATE, GTANSWERVALUE
ORDER BY EVENT_DATE
```

Will need to test this following one works

```sql
WITH FIRST_PASS AS
  (SELECT PLAYER_START_DATE,
          DATEDIFF(DAY, PLAYER_START_DATE, EVENT_DATE) AS DAYS_SINCE_INSTALL,
          ROUND(COUNT(DISTINCT USER_ID)/MAX(COUNT(DISTINCT USER_ID)) OVER (PARTITION BY PLAYER_START_DATE)*100., 2.) AS "% RETENTION",
          MIN(MIN(EVENT_DATE)) OVER () AS FIRST_EVENT_DATE,
          GTANSWER
   FROM FACT_USER_SESSIONS_DAY
   JOIN (SELECT USERID, FIRST(GTANSWERVALUE) AS GTANSWER
         FROM EVENTS
         WHERE EVENTNAME = 'gameTuneAnswerUsed'
         AND GTANSWERNAME = 'difficulty_ramp'
         GROUP BY USERID) ON USER_ID = USERID
   ON USER_ID = USERID
   WHERE EVENT_DATE>=PLAYER_START_DATE
     AND DATEDIFF(DAY, PLAYER_START_DATE, EVENT_DATE)<DATEDIFF(DAY, PLAYER_START_DATE, CURRENT_DATE)
   GROUP BY PLAYER_START_DATE,
            DAYS_SINCE_INSTALL,
            GTANSWER)
SELECT *
FROM FIRST_PASS
WHERE PLAYER_START_DATE > FIRST_EVENT_DATE
ORDER BY PLAYER_START_DATE,
         DAYS_SINCE_INSTALL
```
